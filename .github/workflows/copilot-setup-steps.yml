name: Copilot Setup Steps
"on":
  pull_request:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  push:
    paths:
    - .github/workflows/copilot-setup-steps.yml
  workflow_dispatch: null
jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
    - name: Install gh-aw extension
      run: curl -fsSL https://raw.githubusercontent.com/githubnext/gh-aw/refs/heads/main/install-gh-aw.sh | bash
    - name: Verify gh-aw installation
      run: gh aw version
    - name: Checkout repository
      uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
    - name: Install protobuf
      run: ./scripts/install-protobuf.sh
    - name: Setup Rust toolchain
      uses: actions-rust-lang/setup-rust-toolchain@1780873c7b576612439a134613cc4cc74ce5538c
      with:
        components: rustfmt, clippy
    - name: Install nightly Rust for formatting
      run: rustup toolchain install nightly --component rustfmt
    - name: Add wasm32-wasip2 target
      run: rustup target add wasm32-wasip2
    - name: Setup just
      uses: extractions/setup-just@e33e0265a09d6d736e2ee1e0eb685ef1de4669ff
    - name: Setup wasm-tools
      uses: bytecodealliance/actions/wasm-tools/setup@3b93676295fd6f7eaa7af2c2785539e052fa8349
    - name: Setup uv
      uses: astral-sh/setup-uv@3259c6206f993105e3a61b142c2d97bf4b9ef83d
    - name: Setup TinyGo
      uses: acifani/setup-tinygo@db56321a62b9a67922bb9ac8f9d085e218807bb3
      with:
        tinygo-version: 0.36.0
    - name: Cache Rust dependencies
      uses: ./.github/actions/rust-cache
    - name: Install gh-aw extension
      run: gh extension install githubnext/gh-aw || true
      env:
        GH_TOKEN: ${{ github.token }}
    - name: Setup kind cluster
      uses: helm/kind-action@0025e74a8c7512023d06dc019c617aa3cf561fde
      with:
        cluster_name: wassette-dev
        wait: 300s
    - name: Verify tool installations
      run: "echo \"=== Development Environment Setup Complete ===\"\necho \"\"\necho \"Rust toolchain:\"\nrustc --version\ncargo --version\necho \"\"\necho \"Nightly formatter:\"\ncargo +nightly fmt --version\necho \"\"\necho \"Build tools:\"\njust --version\nprotoc --version\nwasm-tools --version\necho \"\"\necho \"Language support:\"\nuv --version\ntinygo version\necho \"\"\necho \"WASM target installed:\"\nrustup target list --installed | grep wasm32-wasip2\necho \"\"\necho \"GitHub extensions:\"\ngh extension list\necho \"\"\necho \"Kubernetes cluster:\"\nkubectl cluster-info || true\nkubectl get nodes || true\necho \"\"\necho \"=== Ready for development! ===\"\necho \"You can now run:\"\necho \"  - just build     # Build the project\"\necho \"  - just test      # Run tests\"\necho \"  - just run       # Start MCP server\"\necho \"  - cargo clippy   # Run linter\"\necho \"  - kubectl get pods -A   # Check Kubernetes cluster\"\n"
      env:
        GH_TOKEN: ${{ github.token }}
